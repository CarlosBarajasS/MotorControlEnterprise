<div class="topbar">
    <div>
        <h1>Gesti√≥n de C√°maras IP</h1>
        <p class="subtitle">Administra los feeds de video RTSP e integra nodos al sistema HLS en el Edge.</p>
    </div>
    <div style="display: flex; gap: 12px;">
        <button class="btn-primary" (click)="openCreate()">+ Nueva C√°mara</button>
        <button class="btn-secondary" (click)="loadData()">üîÑ Actualizar</button>
    </div>
</div>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Ubicaci√≥n</th>
                <th>RTSP URL</th>
                <th>Gateway Asignado</th>
                <th>A√±adido</th>
                <th class="text-right">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngIf="cameras().length === 0">
                <td colspan="6" class="text-center empty-state">No hay c√°maras registradas. A√±ade una para comenzar
                    el streaming.</td>
            </tr>
            <tr *ngFor="let cam of cameras()">
                <td class="font-medium">
                    <a [routerLink]="['/cameras', cam.id]" class="stream-link" title="Ver Streaming en Vivo">{{
                        cam.name }}</a>
                </td>
                <td>{{ cam.location || 'N/A' }}</td>
                <td class="mono-text url-truncate" [title]="cam.rtspUrl">{{ cam.rtspUrl }}</td>
                <td>{{ cam.clientId ? 'Asignado' : 'Sin asignar' }}</td>
                <td class="text-muted">{{ cam.createdAt | date:'shortDate' }}</td>
                <td class="actions-cell">
                    <a class="action-btn" [routerLink]="['/recordings', cam.id]">Grabaciones</a>
                    <button class="action-btn view" (click)="viewStream(cam.id)">Ver HLS</button>
                    <button class="action-btn edit" (click)="openEdit(cam)">Editar</button>
                    <button class="action-btn delete" (click)="deleteCamera(cam.id)">Borrar</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Modal Formulario -->
<div class="modal-overlay" *ngIf="showModal()">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ modalMode() === 'create' ? 'A√±adir C√°mara IP' : 'Editar C√°mara IP' }}</h2>
            <button class="close-btn" (click)="showModal.set(false)">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="form-row">
                <div class="form-group">
                    <label>Alias / Nombre</label>
                    <input type="text" [(ngModel)]="currentCamera().name" class="form-control"
                        placeholder="Camara Frontal">
                </div>
                <div class="form-group">
                    <label>Ubicaci√≥n F√≠sica</label>
                    <input type="text" [(ngModel)]="currentCamera().location" class="form-control"
                        placeholder="Pasillo A">
                </div>
            </div>
            <div class="form-group">
                <label>URL RTSP</label>
                <input type="text" [(ngModel)]="currentCamera().rtspUrl" class="form-control"
                    placeholder="rtsp://admin:pass@192.168.1.100:554/stream1">
            </div>
            <div class="form-group">
                <label>Asignar a Cliente / Gateway Edge</label>
                <select [(ngModel)]="currentCamera().clientId" class="form-control">
                    <option value="">-- Sin Asignar (Nube Aut√≥noma) --</option>
                    <option *ngFor="let client of clients()" [value]="client.id">{{ client.name }} ({{ client.gatewayId
                        }})</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" (click)="showModal.set(false)">Cancelar</button>
            <button class="btn-primary" (click)="saveCamera()">Guardar C√°mara</button>
        </div>
    </div>
</div>