<div class="layout-container" *ngIf="camera()">
  <div class="header-section">
    <div>
      <a routerLink="/cameras" class="back-link">‚Üê Volver a C√°maras</a>
      <h1>{{ camera().name || 'C√°mara' }}</h1>
      <p>
        <span class="status-indicator" [class.online]="camStatus().isOnline"></span>
        {{ camStatus().isOnline ? 'Online (En Vivo)' : 'Fuera de L√≠nea / Sin Se√±al' }}
        <span class="meta-separator">|</span> Ubicaci√≥n: {{ camera().location || 'Desconocida' }}
      </p>
    </div>
  </div>

  <div class="content-grid">
    <!-- Video Player Column -->
    <div class="video-card">
      <div class="video-wrapper">
        <video #videoElement controls autoplay muted playsinline class="video-player"></video>
      </div>
      <div class="video-footer">
        <p class="source-url" title="Stream URL">{{ camera().rtspUrl }}</p>
        <span class="badge hls-badge">HLS Stream Edge</span>
      </div>
    </div>

    <!-- Controls Column -->
    <div class="controls-column">
      <div class="panel-card ptz-panel">
        <h3><span class="icon">üïπÔ∏è</span> Control PTZ</h3>
        <p class="help-text">Mant√©n presionado para mover la c√°mara si soporta protocolo ONVIF/PTZ.</p>

        <div class="joystick-grid">
          <button class="ptz-btn diag" (mousedown)="ptzMove(-70, 70, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚Üñ</button>
          <button class="ptz-btn" (mousedown)="ptzMove(0, 100, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚¨ÜÔ∏è</button>
          <button class="ptz-btn diag" (mousedown)="ptzMove(70, 70, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚Üó</button>

          <button class="ptz-btn" (mousedown)="ptzMove(-100, 0, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚¨ÖÔ∏è</button>
          <button class="ptz-btn stop" (click)="ptzStop()">‚èπÔ∏è</button>
          <button class="ptz-btn" (mousedown)="ptzMove(100, 0, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚û°Ô∏è</button>

          <button class="ptz-btn diag" (mousedown)="ptzMove(-70, -70, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚Üô</button>
          <button class="ptz-btn" (mousedown)="ptzMove(0, -100, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚¨áÔ∏è</button>
          <button class="ptz-btn diag" (mousedown)="ptzMove(70, -70, 0)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚Üò</button>
        </div>

        <div class="zoom-controls">
          <button class="ptz-btn zoom" (mousedown)="ptzMove(0, 0, 100)" (mouseup)="ptzStop()" (mouseleave)="ptzStop()">‚ûï
            Zoom In</button>
          <button class="ptz-btn zoom" (mousedown)="ptzMove(0, 0, -100)" (mouseup)="ptzStop()"
            (mouseleave)="ptzStop()">‚ûñ Zoom Out</button>
        </div>

        <div class="presets-section" *ngIf="presets().length > 0">
          <h4 style="font-size:12px;color:var(--muted);margin:12px 0 6px;">Presets</h4>
          <div style="display:flex;gap:6px;flex-wrap:wrap;">
            <button class="ptz-btn" *ngFor="let p of presets()" (click)="gotoPreset(p.id)"
              style="font-size:11px;padding:4px 8px;">{{ p.name }}</button>
          </div>
        </div>
      </div>

      <div class="panel-card info-panel">
        <h3>Informaci√≥n T√©cnica</h3>
        <ul>
          <li><strong>ID:</strong> <span class="mono">{{ camera().id }}</span></li>
          <li><strong>Gateway / Nodo:</strong> <span class="mono">{{ camera().clientId || 'Independiente' }}</span></li>
          <li><strong>Creado:</strong> {{ camera().createdAt | date:'medium' }}</li>
          <li><strong>Visto por √∫ltima vez:</strong> {{ camStatus().lastSeen | date:'mediumTime' || 'N/A' }}</li>
        </ul>
      </div>
    </div>
  </div>
</div>