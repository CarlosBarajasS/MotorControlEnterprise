<div class="topbar">
    <div>
        <h1>Dashboard Central</h1>
        <p class="subtitle">Monitoreo en tiempo real de nodos Edge IoT</p>
    </div>
    <button class="btn-primary" (click)="fetchClients()">ðŸ”„ Actualizar Datos</button>
</div>

<div class="stats" style="display: flex; gap: 1rem; margin-bottom: 24px;">
    <div class="card" style="padding: 1.5rem; flex: 1;">
        <span
            style="font-size: 0.85rem; color: var(--muted); display: block; margin-bottom: 0.5rem; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;">Gateways
            Activos</span>
        <strong style="font-size: 1.8rem; color: var(--ink);">{{ stats().active }} / {{ stats().total }}</strong>
    </div>
    <div class="card" style="padding: 1.5rem; flex: 1;">
        <span
            style="font-size: 0.85rem; color: var(--muted); display: block; margin-bottom: 0.5rem; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase;">CÃ¡maras
            Online</span>
        <strong style="font-size: 1.8rem; color: var(--ink);">{{ camerasOnline() }}</strong>
    </div>
</div>

<div class="gateways-grid"
    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
    <div class="card gateway-card" *ngFor="let gw of gateways()" [class.online]="gw.status === 'active'"
        [class.offline]="gw.status !== 'active'" style="padding: 1.5rem;">
        <div class="gw-header"
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin:0; font-size: 1.15rem;">{{ gw.name }}</h3>
            <span class="badge" [class.online]="gw.status === 'active'" [class.offline]="gw.status !== 'active'">
                {{ gw.status | uppercase }}
            </span>
        </div>

        <div class="gw-body">
            <p class="subtitle" style="font-family: monospace; margin-bottom: 0.25rem;">ID: <strong>{{ gw.gatewayId
                    }}</strong></p>
            <p class="subtitle" style="margin-bottom: 1.5rem;">Creado: {{ gw.createdAt | date:'short' }}</p>

            <div class="camera-list" *ngIf="gw.status === 'active'"
                style="background: rgba(15, 23, 42, 0.03); padding: 1.25rem; border-radius: 12px; border: 1px solid var(--outline);">
                <h4
                    style="margin: 0 0 0.75rem; font-size: 0.8rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                    CÃ¡maras Activas</h4>
                <div *ngFor="let cam of cameras()" style="margin-bottom:6px;">
                    <button class="cam-btn"
                        (click)="viewCamera(cam.streams?.hls ?? '/api/admin/stream/' + cam.id + '/hls')">
                        ðŸŽ¥ {{ cam.name }}
                    </button>
                </div>
                <p *ngIf="cameras().length === 0" style="font-size:12px;color:var(--muted)">Sin cÃ¡maras asignadas</p>
            </div>
        </div>
    </div>
</div>

<section class="telemetry-section" style="margin-top: 3.5rem;">
    <div class="topbar" style="margin-bottom: 1.5rem;">
        <div>
            <h2>AnÃ¡lisis de TelemetrÃ­a HMI</h2>
            <p class="subtitle">MÃ©tricas consolidadas de sensores (Voltaje, Corriente y RPM)</p>
        </div>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
        <app-motor-control deviceId="device-01"></app-motor-control>
        <app-telemetry-dashboard></app-telemetry-dashboard>
    </div>
</section>

<!-- Modal Visor de CÃ¡mara -->
<div class="camera-modal-overlay" *ngIf="selectedCameraStream" (click)="closeCamera()">
    <div class="camera-modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>VisualizaciÃ³n en Vivo (MediaMTX Stream)</h3>
            <button class="close-btn" (click)="closeCamera()">âœ•</button>
        </div>
        <div class="modal-body">
            <app-camera-viewer [streamUrl]="selectedCameraStream"></app-camera-viewer>
        </div>
    </div>
</div>