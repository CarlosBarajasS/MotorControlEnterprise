<div class="topbar">
  <div>
    <h1>Dashboard Central</h1>
    <p class="subtitle">Monitoreo en tiempo real de nodos Edge IoT</p>
  </div>
  <button class="btn-primary" (click)="fetchClients()">ðŸ”„ Actualizar Datos</button>
</div>

<!-- Stat Cards -->
<div class="stats-grid">
  <div class="stat-card">
    <h3>Gateways Activos</h3>
    <div class="stat-value">{{ stats().active }} / {{ stats().total }}</div>
    <div class="stat-subtitle">nodos edge registrados</div>
  </div>
  <div class="stat-card">
    <h3>CÃ¡maras Online</h3>
    <div class="stat-value">{{ camerasOnline() }}</div>
    <div class="stat-subtitle">transmitiendo ahora</div>
  </div>
</div>

<!-- Gateways Grid -->
<div class="gateways-grid">
  <div class="device-card" *ngFor="let gw of gateways()"
       [class.online]="gw.status === 'active'" [class.offline]="gw.status !== 'active'">
    <div class="device-header">
      <h3>{{ gw.name }}</h3>
      <span class="badge" [class.online]="gw.status === 'active'" [class.offline]="gw.status !== 'active'">
        {{ gw.status | uppercase }}
      </span>
    </div>
    <div class="device-meta">
      <p class="mono-id">ID: {{ gw.gatewayId }}</p>
      <p class="date-label">Creado: {{ gw.createdAt | date:'short' }}</p>
    </div>
    <div class="camera-list" *ngIf="gw.status === 'active'">
      <h4 class="cam-list-title">CÃ¡maras Activas</h4>
      <button class="cam-btn" *ngFor="let cam of cameras()"
              (click)="viewCamera('/api/stream/' + cam.id + '/hls')">
        ðŸŽ¥ {{ cam.name }}
      </button>
      <p class="empty-cam" *ngIf="cameras().length === 0">Sin cÃ¡maras asignadas</p>
    </div>
  </div>
</div>

<!-- Telemetry Section -->
<section class="telemetry-section">
  <div class="topbar" style="margin-bottom: 1.5rem;">
    <div>
      <h2>AnÃ¡lisis de TelemetrÃ­a HMI</h2>
      <p class="subtitle">MÃ©tricas consolidadas de sensores (Voltaje, Corriente y RPM)</p>
    </div>
  </div>
  <div class="telemetry-grid">
    <app-motor-control deviceId="device-01"></app-motor-control>
    <app-telemetry-dashboard></app-telemetry-dashboard>
  </div>
</section>

<!-- Modal Visor de CÃ¡mara -->
<div class="camera-modal-overlay" *ngIf="selectedCameraStream" (click)="closeCamera()">
  <div class="camera-modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>VisualizaciÃ³n en Vivo</h3>
      <button class="close-btn" (click)="closeCamera()">âœ•</button>
    </div>
    <div class="modal-body">
      <app-camera-viewer [streamUrl]="selectedCameraStream"></app-camera-viewer>
    </div>
  </div>
</div>