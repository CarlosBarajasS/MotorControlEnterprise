<div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <svg xmlns="http://www.w3.org/0000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                <rect x="9" y="9" width="6" height="6"></rect>
                <line x1="9" y1="1" x2="9" y2="4"></line>
                <line x1="15" y1="1" x2="15" y2="4"></line>
                <line x1="9" y1="20" x2="9" y2="23"></line>
                <line x1="15" y1="20" x2="15" y2="23"></line>
            </svg>
            <h2>MCE Edge</h2>
        </div>

        <nav>
            <a routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">Overview</a>
            <a routerLink="/motors" routerLinkActive="active">Motores Industriales</a>
            <a routerLink="/telemetry-history" routerLinkActive="active">Historial de Sensores</a>
            <a routerLink="/clients" routerLinkActive="active">Gateways (Clientes)</a>
            <a routerLink="/cameras" routerLinkActive="active">C√°maras IP</a>
            <a routerLink="/users" routerLinkActive="active">Gesti√≥n de Usuarios</a>
            <a>Configuraci√≥n</a>
        </nav>

        <div class="sidebar-footer">
            <button class="logout-btn" (click)="logout()">Cerrar Sesi√≥n</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="content">
        <header>
            <div class="header-titles">
                <h1>Dashboard Central</h1>
                <p>Monitoreo en tiempo real de nodos Edge IoT</p>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <span>Gateways Activos</span>
                    <strong>{{ stats().active }} / {{ stats().total }}</strong>
                </div>
                <div class="stat-card">
                    <span>C√°maras Online</span>
                    <strong>--</strong>
                </div>
            </div>
        </header>

        <div class="gateways-grid">
            <div class="gateway-card" *ngFor="let gw of gateways()">
                <div class="gw-header">
                    <h3>{{ gw.name }}</h3>
                    <span class="status-badge" [class.online]="gw.status === 'active'"
                        [class.offline]="gw.status !== 'active'">
                        {{ gw.status | uppercase }}
                    </span>
                </div>

                <div class="gw-body">
                    <p class="subtitle">Gateway ID: <strong>{{ gw.gatewayId }}</strong></p>
                    <p class="last-seen">Creado: {{ gw.createdAt | date:'short' }}</p>

                    <div class="camera-list" *ngIf="gw.status === 'active'">
                        <h4>C√°maras Activas</h4>
                        <button class="cam-btn" (click)="viewCamera('http://localhost:8888/cam-principal')">
                            üé• Entrada Principal
                        </button>
                        <button class="cam-btn" (click)="viewCamera('http://localhost:8888/cam-patio')">
                            üé• Patio Trasero
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <section class="telemetry-section" style="margin-top: 3rem;">
            <div class="header-titles" style="margin-bottom: 1.5rem;">
                <h2>An√°lisis de Telemetr√≠a HMI</h2>
                <p>M√©tricas consolidadas de sensores (Voltaje, Corriente y RPM)</p>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
                <app-motor-control deviceId="device-01"></app-motor-control>
                <app-telemetry-dashboard></app-telemetry-dashboard>
            </div>
        </section>
    </main>
</div>

<!-- Modal Visor de C√°mara -->
<div class="camera-modal-overlay" *ngIf="selectedCameraStream" (click)="closeCamera()">
    <div class="camera-modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Visualizaci√≥n en Vivo (MediaMTX Stream)</h3>
            <button class="close-btn" (click)="closeCamera()">‚úï</button>
        </div>
        <div class="modal-body">
            <app-camera-viewer [streamUrl]="selectedCameraStream"></app-camera-viewer>
        </div>
    </div>
</div>