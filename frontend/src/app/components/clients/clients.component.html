<div class="clients-layout">
    <!-- NEW TOP HEADER (w594Q) -->
    <div class="new-top">
        <div class="t-info">
            <h1>Clientes Corporativos</h1>
            <p>Gestión de permisos, accesos web y facturación de organizaciones</p>
        </div>
        <button class="header-btn" (click)="openCreate()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Añadir Nuevo Cliente
        </button>
    </div>

    <!-- SEARCH & FILTERS -->
    <div style="margin: 24px 0; display:flex; gap:12px; align-items:center;">
        <div class="search-box">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" placeholder="Buscar cliente por nombre, ubicación o Gateway ID..."
                [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)">
        </div>
        <span style="font-size:13px; color:var(--muted); font-weight: 500;">{{ filtered().length }} resultados</span>
    </div>

    <!-- CLIENT GRID DE TARJETAS -->
    <div class="client-grid">
        <div class="empty-state" *ngIf="filtered().length === 0">
            <p>No se encontraron clientes corporativos registrados.</p>
        </div>

        <div class="client-card" *ngFor="let client of filtered()">
            <div class="card-header">
                <div>
                    <h3>{{ client.name }}</h3>
                    <p class="role">{{ client.businessType || 'Sin clasificar' }}</p>
                </div>
                <!-- Menú de acciones 3 dots o editar -->
                <button class="icon-action" (click)="openEdit(client)" title="Editar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon>
                    </svg>
                </button>
            </div>

            <div class="card-body">
                <div class="info-row">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    <span>{{ client.city || 'Ubicación local' }}{{ client.state ? ', ' + client.state : '' }}</span>
                </div>
                <div class="info-row">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                        </path>
                    </svg>
                    <div style="display:flex; flex-direction:column; gap:2px;">
                        <span>{{ client.contactName || 'No definido' }}</span>
                        <span style="font-size:11px; color:#64748b;">{{ client.contactPhone || '—' }}</span>
                    </div>
                </div>
                <div class="info-row" style="margin-top:4px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                        <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                        <line x1="6" y1="6" x2="6.01" y2="6"></line>
                        <line x1="6" y1="18" x2="6.01" y2="18"></line>
                    </svg>
                    <span class="mono">{{ client.gatewayId || 'Sin asignar' }}</span>
                </div>
            </div>

            <div class="card-footer">
                <span class="status-badge" [class.active]="client.status === 'active'" (click)="toggleStatus(client)">
                    {{ client.status | uppercase }}
                </span>

                <div class="cloud-toggle" title="Almacenamiento Cloud">
                    <span style="font-size:10px; color:#94a3b8; font-weight:600;">CLOUD</span>
                    <label class="toggle-switch">
                        <input type="checkbox" [checked]="client.cloudStorageActive"
                            (change)="toggleCloudStorage(client)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal Formulario -->
    <div class="modal-overlay" *ngIf="showModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ modalMode() === 'create' ? 'Crear Nuevo Cliente' : 'Editar Cliente' }}</h2>
                <button class="close-btn" (click)="showModal.set(false)">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Razón Social / Nombre</label>
                    <input type="text" [(ngModel)]="currentClient().name" class="form-control"
                        placeholder="Empresa S.A. de C.V.">
                </div>
                <div class="form-group">
                    <label>Tipo de Negocio</label>
                    <select [(ngModel)]="currentClient().businessType" class="form-control">
                        <option value="">-- Seleccionar --</option>
                        <option value="Retail">Retail</option>
                        <option value="Restaurante">Restaurante</option>
                        <option value="Oficina">Oficina</option>
                        <option value="Bodega">Bodega</option>
                        <option value="Manufactura">Manufactura</option>
                        <option value="Educacion">Educacion</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>RFC</label>
                        <input type="text" [(ngModel)]="currentClient().rfc" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Ciudad</label>
                        <input type="text" [(ngModel)]="currentClient().city" class="form-control">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Estado</label>
                        <input type="text" [(ngModel)]="currentClient().state" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>País</label>
                        <input type="text" [(ngModel)]="currentClient().country" class="form-control"
                            placeholder="México">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre del Contacto</label>
                        <input type="text" [(ngModel)]="currentClient().contactName" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input type="tel" [(ngModel)]="currentClient().contactPhone" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email del Contacto</label>
                    <input type="email" [(ngModel)]="currentClient().contactEmail" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" (click)="showModal.set(false)">Cancelar</button>
                <div style="display:flex;gap:8px;">
                    <button *ngIf="modalMode() === 'edit'" class="btn-secondary"
                        style="color:#ef4444; border-color: rgba(239, 68, 68, 0.3);"
                        (click)="deleteClient(currentClient().id)">Eliminar</button>
                    <button class="btn-primary" (click)="saveClient()">Guardar Datos</button>
                </div>
            </div>
        </div>
    </div>
</div>