<div class="telemetry-dashboard-container">
    <!-- Stats Section -->
    <div class="stats-grid" *ngIf="stats()">
        <div class="stat-card">
            <h3>Dispositivos Totales</h3>
            <div class="value">{{ stats().totalDevices || 0 }}</div>
            <div class="subtitle">Registrados en Plataforma</div>
        </div>
        <div class="stat-card">
            <h3>En Línea</h3>
            <div class="value">{{ stats().activeDevices || 0 }}</div>
            <div class="subtitle">Conectados al Edge</div>
        </div>
        <div class="stat-card">
            <h3>Ayer vs Hoy</h3>
            <div class="value">{{ stats().todayRecords || 0 }}</div>
            <div class="subtitle">Eventos Capturados</div>
        </div>
    </div>

    <div class="stats-grid" *ngIf="!stats()">
        <div class="loading-state">Cargando métricas de la API...</div>
    </div>

    <!-- Connected Devices Table via Live API -->
    <h2 class="section-title">Nodos Edge Activos (MQTT)</h2>

    <div class="devices-grid" *ngIf="devices().length > 0">
        <div class="device-card" *ngFor="let device of devices()" [ngClass]="device.online ? 'online' : 'offline'">
            <div class="device-header">
                <span class="device-id"><i class="icon-edge"></i> {{ device.deviceId }}</span>
                <span class="status-badge" [ngClass]="device.online ? 'online' : 'offline'">
                    {{ device.online ? 'Online' : 'Desconectado' }}
                </span>
            </div>
            <div class="telemetry-grid">
                <div class="telemetry-item">
                    <label>Velocidad (RPM)</label>
                    <div class="value">{{ device.speed || 0 }}</div>
                </div>
                <div class="telemetry-item">
                    <label>Estado</label>
                    <div class="value">{{ device.state || 'N/A' }}</div>
                </div>
                <div class="telemetry-item">
                    <label>Corriente (A)</label>
                    <div class="value">{{ (device.current || 0) | number:'1.2-2' }}</div>
                </div>
                <div class="telemetry-item">
                    <label>Voltaje (V)</label>
                    <div class="value">{{ (device.voltage || 0) | number:'1.2-2' }}</div>
                </div>
            </div>
            <div class="device-footer">
                Última Lectura: {{ device.timestamp | date:'mediumTime' }}
            </div>
        </div>
    </div>

    <div class="no-devices" *ngIf="devices().length === 0">
        <p>No hay nodos de telemetría reportando al MQTT de Central.</p>
    </div>

    <!-- Realtime Chart -->
    <div class="chart-container">
        <h3><span class="icon-chart"></span> Comportamiento Global del Motor (Tiempo Real)</h3>
        <div class="chart-wrapper">
            <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="lineChartType">
            </canvas>
        </div>
    </div>
</div>