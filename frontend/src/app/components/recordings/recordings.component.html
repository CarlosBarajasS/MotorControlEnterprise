<!-- TOPBAR -->
<div class="topbar">
  <div>
    <a routerLink="/cameras" class="back-link">‚Üê Volver a C√°maras</a>
    <h1>Grabaciones ¬∑ <span style="color:var(--accent);font-size:20px;">{{ cameraName() }}</span></h1>
    <p class="subtitle">Grabaciones cloud NAS para esta c√°mara ‚Äî acceso con token autenticado</p>
  </div>
  <div style="display:flex;gap:12px;align-items:center;">
    <span class="badge active">{{ cloudRecordings().length }} grabaciones hoy</span>
    <button class="btn-secondary" (click)="loadCloudRecordings(selectedDate())">üîÑ Actualizar</button>
  </div>
</div>

<!-- STAT CARDS -->
<div class="rec-stats">
  <div class="rec-stat">
    <div class="rec-stat-val">{{ cloudRecordings().length }}</div>
    <div class="rec-stat-lbl">Total Hoy</div>
  </div>
  <div class="rec-stat">
    <div class="rec-stat-val blue">{{ totalSizeMb() | number:'1.0-1' }} MB</div>
    <div class="rec-stat-lbl">Cloud NAS</div>
    <div class="rec-stat-bar">
      <div class="rec-stat-bar-fill blue" [style.width.%]="cloudPct()"></div>
    </div>
  </div>
  <div class="rec-stat">
    <div class="rec-stat-val teal">0</div>
    <div class="rec-stat-lbl">NVR Local</div>
    <div class="rec-stat-bar">
      <div class="rec-stat-bar-fill teal" style="width:0%"></div>
    </div>
  </div>
  <div class="rec-stat" [class.has-value]="0 > 0">
    <div class="rec-stat-val amber">0</div>
    <div class="rec-stat-lbl">Procesando</div>
  </div>
</div>

<!-- FILTERS ROW -->
<div class="rec-filters">
  <div class="rec-date-group">
    <label>Fecha</label>
    <input type="date" class="form-control date-input" [ngModel]="selectedDate()" (ngModelChange)="selectDate($event)">
  </div>
  <input type="text" class="rec-search" placeholder="üîç Buscar grabaci√≥n..." [ngModel]="searchRec()"
    (ngModelChange)="searchRec.set($event)">
  <div class="filter-pills">
    <button class="filter-pill" [class.active]="filterType() === 'all'" (click)="filterType.set('all')">Todas</button>
    <button class="filter-pill" [class.active]="filterType() === 'cloud'" (click)="filterType.set('cloud')">‚òÅ
      Cloud</button>
  </div>
</div>

<!-- QUICK DATE PILLS -->
<div class="quick-dates" *ngIf="availableDates().length > 0">
  <small>Fechas con grabaciones disponibles:</small>
  <div class="date-pills">
    <span *ngFor="let d of availableDates()" class="date-pill" [class.active]="d === selectedDate()"
      (click)="selectDate(d)">{{ d }}</span>
  </div>
</div>

<!-- RECORDINGS TABLE -->
<div class="rec-table-wrap">
  <!-- Loading -->
  <div class="rec-loading" *ngIf="loadingRecordings()">
    <div class="spinner"></div>
    <span>Cargando grabaciones...</span>
  </div>

  <!-- Table -->
  <table class="rec-table" *ngIf="!loadingRecordings() && filteredRecordings().length > 0">
    <thead>
      <tr>
        <th>C√°mara / Archivo</th>
        <th>Fecha¬∑Hora Inicio</th>
        <th>Tama√±o</th>
        <th>Tipo</th>
        <th>Estado</th>
        <th class="text-right">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let file of filteredRecordings(); let i = index" [class.even]="i % 2 === 0">
        <td class="font-medium">{{ file.filename || file.name }}</td>
        <td class="text-muted">{{ file.startTime | date:'yyyy-MM-dd HH:mm:ss' }}</td>
        <td class="text-muted">{{ file.sizeMb | number:'1.1-1' }} MB</td>
        <td><span class="badge active" style="font-size:10px;">Cloud NAS</span></td>
        <td><span class="badge online">Lista</span></td>
        <td class="text-right">
          <button class="rec-btn-play" (click)="playCloudVideo(file.path)">‚ñ∂ Reproducir</button>
          <a class="rec-btn-dl" [href]="getDownloadUrl(file.path)" target="_blank">‚¨á Descargar</a>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Empty state -->
  <div class="rec-empty" *ngIf="!loadingRecordings() && filteredRecordings().length === 0">
    <div class="empty-icon">üéûÔ∏è</div>
    <h3>Sin grabaciones</h3>
    <p>No hay grabaciones cloud para la fecha seleccionada. Elige otro d√≠a con el selector o las pills superiores.</p>
  </div>
</div>

<!-- VIDEO PLAYER -->
<div class="rec-player-wrap" *ngIf="currentVideoSource()">
  <div class="rec-player-header">
    <div class="now-playing-label">‚ñ∂ Reproduciendo</div>
    <button class="close-btn" (click)="currentVideoSource.set(null)">‚úï Cerrar</button>
  </div>
  <video #videoPlayer controls class="rec-player-video"></video>
</div>